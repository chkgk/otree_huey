{{ block title }}
    Page title
{{ endblock }}
{{ block content }}

    <p>Player's inputs are: {{ player.random_number1 }} and {{ player.random_number2 }}</p>
    <p>The sum is: <span id="result"></span></p>

    <button type="button" class="btn btn-success" id="start">Start long calculation task</button>

    {{ formfields }}
    {{ next_button }}

{{ endblock }}


{{ block scripts }}
    <script>
        let output = document.getElementById('result');
        let start_button = document.getElementById('start');
        let next_button = document.getElementsByClassName('otree-btn-next')[0];
        
        let interval_sec = 1; // seconds between result checks
        let interval_id; // reference to the interval timer
        
        // hide the next button for now
        next_button.style.display = 'none';
        
        // when the button is clicked, send a message to otree to start the background task
        // then start checking for a result in regular intervals.
        start_button.addEventListener('click', function(e) {
            start_button.style.display = 'none';
            liveSend({message: 'start'})
            
            interval_id = setInterval(function() {
                liveSend({message: 'get_result'})
                console.log('checking for a result...')
            }, interval_sec * 1000);
        });
        
        // handle data coming from oTree
        function liveRecv(data) {
            if (data['message'] === 'result') {
                console.log('got a result, stop checking')
                clearInterval(interval_id);
                output.innerText = data['result'];
                next_button.style.display = 'block';
            }
        }
        
    </script>
{{ endblock }}